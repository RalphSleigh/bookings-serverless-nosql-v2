// src/local-server.ts
import { wrapLambda } from "convert-lambda-to-express";
import express from "express";

// src/lambda/handler.ts
import middy2 from "@middy/core";
import httpRouterHandler from "@middy/http-router";

// src/lambda/utils.ts
import middy from "@middy/core";
function am_in_lambda() {
  return process.env.LOCAL_SERVER !== "true";
}
var HandlerWrapper = (fn) => {
  return middy(async (event, context) => {
    const result = await fn(event, context);
    return {
      statusCode: 200,
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(result)
    };
  });
};

// src/lambda/endpoints/env.ts
var getEnv = HandlerWrapper(async (event, context) => {
  return { "env": context.config.ENV };
});

// src/lambda/config.ts
import { DynamoDBClient, GetItemCommand } from "@aws-sdk/client-dynamodb";
import { unmarshall } from "@aws-sdk/util-dynamodb";
var configData;
var configMiddleware = () => {
  const before = async (request) => {
    try {
      if (!configData) {
        const dynamodbClientOptions = am_in_lambda() ? { region: "eu-west-2" } : { region: "eu-west-2", endpoint: "http://localhost:8000" };
        const client = new DynamoDBClient(dynamodbClientOptions);
        const input = {
          "Key": {
            "pk": {
              "S": "CONFIG"
            },
            "key": {
              "S": "CURRENT"
            }
          },
          "TableName": "Config"
        };
        const command = new GetItemCommand(input);
        const data = await client.send(command);
        configData = unmarshall(data.Item);
      }
      request.context.config = configData;
    } catch (error) {
      console.log(error);
      throw error;
    } finally {
    }
  };
  return {
    before
  };
};

// src/lambda/handler.ts
import httpHeaderNormalizer from "@middy/http-header-normalizer";
import httpJsonBodyParser from "@middy/http-json-body-parser";
var routes = [
  {
    method: "GET",
    path: "/api/env",
    handler: getEnv
  }
];
var handler = middy2().use(httpHeaderNormalizer()).use(httpJsonBodyParser({ disableContentTypeError: true })).use(configMiddleware()).handler(httpRouterHandler(routes));

// src/local-server.ts
var app = express();
app.get("*", wrapLambda(handler, { region: "eu-west-2" }));
app.post("*", wrapLambda(handler, { region: "eu-west-2" }));
app.listen(8080, () => {
  console.log("Listening on port 8080");
});
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL2xvY2FsLXNlcnZlci50cyIsICIuLi9zcmMvbGFtYmRhL2hhbmRsZXIudHMiLCAiLi4vc3JjL2xhbWJkYS91dGlscy50cyIsICIuLi9zcmMvbGFtYmRhL2VuZHBvaW50cy9lbnYudHMiLCAiLi4vc3JjL2xhbWJkYS9jb25maWcudHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IHdyYXBMYW1iZGEgfSBmcm9tICdjb252ZXJ0LWxhbWJkYS10by1leHByZXNzJztcclxuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XHJcbmltcG9ydCB7IGhhbmRsZXIgfSBmcm9tICcuL2xhbWJkYS9oYW5kbGVyLmpzJ1xyXG5cclxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xyXG5cclxuLy9AdHMtZXhwZWN0LWVycm9yXHJcbmFwcC5nZXQoJyonLCB3cmFwTGFtYmRhKGhhbmRsZXIsIHtyZWdpb246ICdldS13ZXN0LTInfSkpO1xyXG4vL0B0cy1leHBlY3QtZXJyb3JcclxuYXBwLnBvc3QoJyonLCB3cmFwTGFtYmRhKGhhbmRsZXIsIHtyZWdpb246ICdldS13ZXN0LTInfSkpO1xyXG5cclxuYXBwLmxpc3Rlbig4MDgwLCAoKSA9PiB7XHJcbiAgY29uc29sZS5sb2coJ0xpc3RlbmluZyBvbiBwb3J0IDgwODAnKTtcclxufSk7IiwgImltcG9ydCBtaWRkeSBmcm9tIFwiQG1pZGR5L2NvcmVcIjtcclxuaW1wb3J0IGh0dHBSb3V0ZXJIYW5kbGVyLCB7IHR5cGUgTWV0aG9kIH0gZnJvbSAnQG1pZGR5L2h0dHAtcm91dGVyJ1xyXG5pbXBvcnQgdHlwZSB7IEFQSUdhdGV3YXlQcm94eUV2ZW50LCBBUElHYXRld2F5UHJveHlSZXN1bHQsIENvbnRleHQgfSBmcm9tICdhd3MtbGFtYmRhJztcclxuaW1wb3J0IHsgZ2V0RW52IH0gZnJvbSBcIi4vZW5kcG9pbnRzL2VudlwiO1xyXG5pbXBvcnQgeyBjb25maWdNaWRkbGV3YXJlLCB0eXBlIENvbnRleHRXaXRoQ29uZmlnIH0gZnJvbSBcIi4vY29uZmlnXCI7XHJcbmltcG9ydCBodHRwSGVhZGVyTm9ybWFsaXplciBmcm9tIFwiQG1pZGR5L2h0dHAtaGVhZGVyLW5vcm1hbGl6ZXJcIjtcclxuaW1wb3J0IGh0dHBKc29uQm9keVBhcnNlciBmcm9tIFwiQG1pZGR5L2h0dHAtanNvbi1ib2R5LXBhcnNlclwiO1xyXG5cclxuY29uc3Qgcm91dGVzID0gW1xyXG4gICAge1xyXG4gICAgICBtZXRob2Q6IFwiR0VUXCIgYXMgTWV0aG9kLFxyXG4gICAgICBwYXRoOiAnL2FwaS9lbnYnLFxyXG4gICAgICBoYW5kbGVyOiBnZXRFbnZcclxuICAgIH1cclxuICBdXHJcbiAgXHJcbmV4cG9ydCBjb25zdCBoYW5kbGVyID0gbWlkZHkoKVxyXG4vLy51c2UoaW5wdXRPdXRwdXRMb2dnZXIoKSlcclxuLnVzZShodHRwSGVhZGVyTm9ybWFsaXplcigpKVxyXG4udXNlKGh0dHBKc29uQm9keVBhcnNlcih7ZGlzYWJsZUNvbnRlbnRUeXBlRXJyb3I6IHRydWV9KSlcclxuLnVzZShjb25maWdNaWRkbGV3YXJlKCkpXHJcbi5oYW5kbGVyKGh0dHBSb3V0ZXJIYW5kbGVyKHJvdXRlcykpIiwgImltcG9ydCB0eXBlIHsgQVBJR2F0ZXdheVByb3h5RXZlbnQsIEFQSUdhdGV3YXlQcm94eVJlc3VsdCB9IGZyb20gXCJhd3MtbGFtYmRhXCJcclxuaW1wb3J0IHR5cGUgeyBDb250ZXh0V2l0aENvbmZpZyB9IGZyb20gXCIuL2NvbmZpZ1wiXHJcbmltcG9ydCBtaWRkeSBmcm9tIFwiQG1pZGR5L2NvcmVcIlxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFtX2luX2xhbWJkYSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiBwcm9jZXNzLmVudi5MT0NBTF9TRVJWRVIgIT09IFwidHJ1ZVwiXHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIEhhbmRsZXJGdW5jdGlvbiA9IChldmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnQsIGNvbnRleHQ6IENvbnRleHRXaXRoQ29uZmlnKSA9PiBQcm9taXNlPGFueT5cclxuZXhwb3J0IHR5cGUgSGFuZGxlcldyYXBwZXJUeXBlID0gKGZuOiBIYW5kbGVyRnVuY3Rpb24pID0+IG1pZGR5Lk1pZGR5ZmllZEhhbmRsZXI8QVBJR2F0ZXdheVByb3h5RXZlbnQsIEFQSUdhdGV3YXlQcm94eVJlc3VsdCwgRXJyb3IsIENvbnRleHRXaXRoQ29uZmlnPlxyXG5cclxuZXhwb3J0IGNvbnN0IEhhbmRsZXJXcmFwcGVyOiBIYW5kbGVyV3JhcHBlclR5cGUgPSBmbiA9PiB7XHJcbiAgICByZXR1cm4gbWlkZHkoYXN5bmMgKGV2ZW50OiBBUElHYXRld2F5UHJveHlFdmVudCwgY29udGV4dDogQ29udGV4dFdpdGhDb25maWcpID0+IHtcclxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBmbihldmVudCwgY29udGV4dClcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBzdGF0dXNDb2RlOiAyMDAsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVzdWx0KVxyXG4gICAgICAgIH0gYXMgQVBJR2F0ZXdheVByb3h5UmVzdWx0XHJcbiAgICB9KVxyXG59IiwgImltcG9ydCB7IEhhbmRsZXJXcmFwcGVyIH0gZnJvbSBcIi4uL3V0aWxzXCI7XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0RW52ID0gSGFuZGxlcldyYXBwZXIoYXN5bmMgKGV2ZW50LCBjb250ZXh0KSA9PiB7XHJcbiAgICByZXR1cm4geyBcImVudlwiOiBjb250ZXh0LmNvbmZpZy5FTlYgfVxyXG59KSIsICJpbXBvcnQgeyBEeW5hbW9EQkNsaWVudCwgR2V0SXRlbUNvbW1hbmQsIFNjYW5Db21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiJ1xyXG5pbXBvcnQgeyB1bm1hcnNoYWxsIH0gZnJvbSAnQGF3cy1zZGsvdXRpbC1keW5hbW9kYidcclxuaW1wb3J0IHsgYW1faW5fbGFtYmRhIH0gZnJvbSAnLi91dGlscydcclxuaW1wb3J0IG1pZGR5IGZyb20gJ0BtaWRkeS9jb3JlJ1xyXG5pbXBvcnQgdHlwZSB7IEFQSUdhdGV3YXlQcm94eUV2ZW50LCBBUElHYXRld2F5UHJveHlSZXN1bHQsIENvbnRleHQgfSBmcm9tICdhd3MtbGFtYmRhJ1xyXG5cclxuXHJcbmV4cG9ydCB0eXBlIENvbmZpZ1R5cGUgPSB7XHJcbiAgQVBQTEVfQ0xJRU5UX0lEOiBzdHJpbmcsXHJcbiAgQVBQTEVfQ0xJRU5UX1NFQ1JFVDogc3RyaW5nLFxyXG4gIEFQUExFX0tFWV9JRDogc3RyaW5nLFxyXG4gIEFQUExFX1RFQU1fSUQ6IHN0cmluZyxcclxuICBCQVNFX1VSTDogc3RyaW5nLFxyXG4gIENPT0tJRV9FWFBJUlk6IG51bWJlcixcclxuICBESVNDT1JEX0VOQUJMRUQ6IGJvb2xlYW4sXHJcbiAgRElTQ09SRF9CT1RfVE9LRU46IHN0cmluZyxcclxuICBESVNDT1JEX0dVSUxEX0lEOiBzdHJpbmcsXHJcbiAgRElTQ09SRF9DSEFOTkVMX0lEOiBzdHJpbmcsXHJcbiAgRElTQ09SRF9XRUJIT09LX1VSTDogc3RyaW5nLFxyXG4gIERJU0NPUkRfUFVCTElDX0tFWTogc3RyaW5nLFxyXG4gIERSSVZFX1NZTkNfRU5BQkxFRDogYm9vbGVhbixcclxuICBFTUFJTF9FTkFCTEVEOiBib29sZWFuLFxyXG4gIEVNQUlMX0ZST006IHN0cmluZyxcclxuICBFTUFJTF9DTElFTlRfRU1BSUw6IHN0cmluZyxcclxuICBFTUFJTF9QUklWQVRFX0tFWTogc3RyaW5nLFxyXG4gIEVOVjogc3RyaW5nLFxyXG4gIEZBQ0VCT09LX0NMSUVOVF9JRDogc3RyaW5nLFxyXG4gIEZBQ0VCT09LX0NMSUVOVF9TRUNSRVQ6IHN0cmluZyxcclxuICBHT09HTEVfQ0xJRU5UX0lEOiBzdHJpbmcsXHJcbiAgR09PR0xFX0NMSUVOVF9TRUNSRVQ6IHN0cmluZyxcclxuICBKV1RfU0VDUkVUOiBzdHJpbmcsXHJcbiAgTUlDUk9TT0ZUX0NMSUVOVF9JRDogc3RyaW5nLFxyXG4gIE1JQ1JPU09GVF9DTElFTlRfU0VDUkVUOiBzdHJpbmcsXHJcbiAgWUFIT09fQ0xJRU5UX0lEOiBzdHJpbmcsXHJcbiAgWUFIT09fQ0xJRU5UX1NFQ1JFVDogc3RyaW5nLFxyXG4gIFNUUklQRV9TRUNSRVRfS0VZOiBzdHJpbmcsXHJcbiAgU1RSSVBFX1dFQkhPT0tfU0VDUkVUOiBzdHJpbmcsXHJcbn1cclxuXHJcbmxldCBjb25maWdEYXRhOiBDb25maWdUeXBlXHJcblxyXG5leHBvcnQgdHlwZSBDb250ZXh0V2l0aENvbmZpZyA9IENvbnRleHQgJiB7IGNvbmZpZzogQ29uZmlnVHlwZSB9XHJcblxyXG5leHBvcnQgY29uc3QgY29uZmlnTWlkZGxld2FyZSA9ICgpOiBtaWRkeS5NaWRkbGV3YXJlT2JqPEFQSUdhdGV3YXlQcm94eUV2ZW50LCBBUElHYXRld2F5UHJveHlSZXN1bHQsIEVycm9yLCBDb250ZXh0V2l0aENvbmZpZz4gPT4ge1xyXG5cclxuICBjb25zdCBiZWZvcmU6IG1pZGR5Lk1pZGRsZXdhcmVGbjxBUElHYXRld2F5UHJveHlFdmVudCwgQVBJR2F0ZXdheVByb3h5UmVzdWx0LCBFcnJvciwgQ29udGV4dFdpdGhDb25maWc+ID0gYXN5bmMgKFxyXG4gICAgcmVxdWVzdFxyXG4gICk6IFByb21pc2U8dm9pZD4gPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBpZighY29uZmlnRGF0YSkge1xyXG4gICAgICAgIGNvbnN0IGR5bmFtb2RiQ2xpZW50T3B0aW9ucyA9IGFtX2luX2xhbWJkYSgpID8geyByZWdpb246ICdldS13ZXN0LTInIH0gOiB7IHJlZ2lvbjogJ2V1LXdlc3QtMicsIGVuZHBvaW50OiAnaHR0cDovL2xvY2FsaG9zdDo4MDAwJyB9XHJcbiAgICAgICAgY29uc3QgY2xpZW50ID0gbmV3IER5bmFtb0RCQ2xpZW50KGR5bmFtb2RiQ2xpZW50T3B0aW9ucylcclxuXHJcbiAgICAgICAgY29uc3QgaW5wdXQgPSB7XHJcbiAgICAgICAgICAgIFwiS2V5XCI6IHtcclxuICAgICAgICAgICAgICBcInBrXCI6IHtcclxuICAgICAgICAgICAgICAgIFwiU1wiOiBcIkNPTkZJR1wiXHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBcImtleVwiOiB7XHJcbiAgICAgICAgICAgICAgICBcIlNcIjogXCJDVVJSRU5UXCJcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIFwiVGFibGVOYW1lXCI6IFwiQ29uZmlnXCJcclxuICAgICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgR2V0SXRlbUNvbW1hbmQoaW5wdXQpXHJcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGNsaWVudC5zZW5kKGNvbW1hbmQpXHJcbiAgICAgICAgY29uZmlnRGF0YSA9IHVubWFyc2hhbGwoZGF0YS5JdGVtISkgYXMgQ29uZmlnVHlwZVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXF1ZXN0LmNvbnRleHQuY29uZmlnID0gY29uZmlnRGF0YSBhcyBDb25maWdUeXBlXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxyXG4gICAgICAgIHRocm93IGVycm9yXHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIC8vIGZpbmFsbHkuXHJcbiAgICB9XHJcbiAgfVxyXG4gIHJldHVybiB7XHJcbiAgICBiZWZvcmVcclxuICB9XHJcbn0iXSwKICAibWFwcGluZ3MiOiAiO0FBQUEsU0FBUyxrQkFBa0I7QUFDM0IsT0FBTyxhQUFhOzs7QUNEcEIsT0FBT0EsWUFBVztBQUNsQixPQUFPLHVCQUF3Qzs7O0FDQy9DLE9BQU8sV0FBVztBQUVYLFNBQVMsZUFBd0I7QUFDcEMsU0FBTyxRQUFRLElBQUksaUJBQWlCO0FBQ3hDO0FBS08sSUFBTSxpQkFBcUMsUUFBTTtBQUNwRCxTQUFPLE1BQU0sT0FBTyxPQUE2QixZQUErQjtBQUM1RSxVQUFNLFNBQVMsTUFBTSxHQUFHLE9BQU8sT0FBTztBQUN0QyxXQUFPO0FBQUEsTUFDSCxZQUFZO0FBQUEsTUFDWixTQUFTO0FBQUEsUUFDTCxnQkFBZ0I7QUFBQSxNQUNwQjtBQUFBLE1BQ0EsTUFBTSxLQUFLLFVBQVUsTUFBTTtBQUFBLElBQy9CO0FBQUEsRUFDSixDQUFDO0FBQ0w7OztBQ3BCTyxJQUFNLFNBQVMsZUFBZSxPQUFPLE9BQU8sWUFBWTtBQUMzRCxTQUFPLEVBQUUsT0FBTyxRQUFRLE9BQU8sSUFBSTtBQUN2QyxDQUFDOzs7QUNKRCxTQUFTLGdCQUFnQixzQkFBbUM7QUFDNUQsU0FBUyxrQkFBa0I7QUFzQzNCLElBQUk7QUFJRyxJQUFNLG1CQUFtQixNQUFrRztBQUVoSSxRQUFNLFNBQW9HLE9BQ3hHLFlBQ2tCO0FBQ2xCLFFBQUk7QUFDQSxVQUFHLENBQUMsWUFBWTtBQUNoQixjQUFNLHdCQUF3QixhQUFhLElBQUksRUFBRSxRQUFRLFlBQVksSUFBSSxFQUFFLFFBQVEsYUFBYSxVQUFVLHdCQUF3QjtBQUNsSSxjQUFNLFNBQVMsSUFBSSxlQUFlLHFCQUFxQjtBQUV2RCxjQUFNLFFBQVE7QUFBQSxVQUNWLE9BQU87QUFBQSxZQUNMLE1BQU07QUFBQSxjQUNKLEtBQUs7QUFBQSxZQUNQO0FBQUEsWUFDQSxPQUFPO0FBQUEsY0FDTCxLQUFLO0FBQUEsWUFDUDtBQUFBLFVBQ0Y7QUFBQSxVQUNBLGFBQWE7QUFBQSxRQUNmO0FBRUYsY0FBTSxVQUFVLElBQUksZUFBZSxLQUFLO0FBQ3hDLGNBQU0sT0FBTyxNQUFNLE9BQU8sS0FBSyxPQUFPO0FBQ3RDLHFCQUFhLFdBQVcsS0FBSyxJQUFLO0FBQUEsTUFDbEM7QUFDQSxjQUFRLFFBQVEsU0FBUztBQUFBLElBQzdCLFNBQVMsT0FBTztBQUNaLGNBQVEsSUFBSSxLQUFLO0FBQ2pCLFlBQU07QUFBQSxJQUNWLFVBQUU7QUFBQSxJQUVGO0FBQUEsRUFDRjtBQUNBLFNBQU87QUFBQSxJQUNMO0FBQUEsRUFDRjtBQUNGOzs7QUgzRUEsT0FBTywwQkFBMEI7QUFDakMsT0FBTyx3QkFBd0I7QUFFL0IsSUFBTSxTQUFTO0FBQUEsRUFDWDtBQUFBLElBQ0UsUUFBUTtBQUFBLElBQ1IsTUFBTTtBQUFBLElBQ04sU0FBUztBQUFBLEVBQ1g7QUFDRjtBQUVLLElBQU0sVUFBVUMsT0FBTSxFQUU1QixJQUFJLHFCQUFxQixDQUFDLEVBQzFCLElBQUksbUJBQW1CLEVBQUMseUJBQXlCLEtBQUksQ0FBQyxDQUFDLEVBQ3ZELElBQUksaUJBQWlCLENBQUMsRUFDdEIsUUFBUSxrQkFBa0IsTUFBTSxDQUFDOzs7QURqQmxDLElBQU0sTUFBTSxRQUFRO0FBR3BCLElBQUksSUFBSSxLQUFLLFdBQVcsU0FBUyxFQUFDLFFBQVEsWUFBVyxDQUFDLENBQUM7QUFFdkQsSUFBSSxLQUFLLEtBQUssV0FBVyxTQUFTLEVBQUMsUUFBUSxZQUFXLENBQUMsQ0FBQztBQUV4RCxJQUFJLE9BQU8sTUFBTSxNQUFNO0FBQ3JCLFVBQVEsSUFBSSx3QkFBd0I7QUFDdEMsQ0FBQzsiLAogICJuYW1lcyI6IFsibWlkZHkiLCAibWlkZHkiXQp9Cg==
